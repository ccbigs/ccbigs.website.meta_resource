# UE学习(07)：关卡

**关卡（Level）** 是游戏的"世界"的全部或一部分。关卡包含玩家可以看到并与之交互的所有内容，例如环境、可用对象、其他角色，等等。在电子游戏中，常常有多个关卡，彼此之间有划分明确的过渡（例如，在你打败一个关卡中的终极boss之后，你就会继续到下一个关卡）。对于虚幻引擎中进行的其他类型的交互式体验，你可以使用不同的关卡在不同种类的展柜或环境之间过渡。

虚幻引擎将每个关卡保存为单独的 `.umap` 文件，这就是为什么你有时会看到关卡被称为 **贴图（Maps）** 。

下面是组合起来创建关卡至少所需的元素列表：

- 一个 `.umap` 文件，即关卡本身。可将其视为保存其他所有内容的容器。
- 一个由 **静态网格体Actor（Static Mesh Actors）** 组成的环境。这些可以是树木、岩石、墙壁或其他环境Fixture。某些场景还使用其他类型的Actor，例如地形Actor或者水体Actor。
- 一个由 **骨骼网格体Actor（Skeletal Mesh Actor）** 表示的玩家角色。
- 一个或多个不同类型的 **光源（lights）** 。
- 环境声音和音效（例如，脚步声）。

复杂的关卡可能包含其他功能，如粒子效果、视效后期处理、关卡流送，等等。

# 使用关卡

和许多其他 **虚幻引擎** 数据类型一样，**关卡** 保存在单独的资产文件中。你可以对关卡资产执行许多常见操作。不过其中有一些特殊的注意事项，将在下面详细介绍。

本文介绍了以下工作流程：

- 创建关卡
- 保存关卡
- 打开关卡

## 创建关卡

虚幻引擎中新建关卡的方法有以下几种：

- 点击 **主菜单** 中的 **文件（File）**，然后点击 **新建关卡（New Level）**。
- 在 **内容浏览器** 中点击右键。然后，在 **创建基本资产（Create Basic Asset）** 下，选择 **关卡（Level）**。
- 使用 **Ctrl+N**（Windows）或 **Cmd+N**（Mac）快捷键。

以上操作都会打开一个 **新建关卡** 窗口，如下所示。

![新关卡窗口](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\new-level-window.png)

**新建关卡（New Level）** 窗口会显示所有可用关卡模板。你可以在以下模板中选择：

- **开放世界（Open World）**：一个包含示例内容的关卡，允许你使用[世界分区](https://docs.unrealengine.com/5.0/zh-CN/building-virtual-worlds/world-partition)来创建大型、可流送的开放世界。
- **空的开放世界（Empty Open World）**：一个使用世界分区的关卡，但不包含任何内容。
- **基本（Basic）**：一个包含地面、光照、大气和指数雾的关卡。
- **空关卡（Empty Level）**：一个没有任何内容的关卡。

在这个窗口中选择你想用的关卡，然后点击 **创建**。新关卡将自动打开。

如果启用了版本控制，在创建和保存新关卡时，将自动上传到版本控制软件。

## 保存关卡

和其他资产一样，在关闭引擎或切换到其他关卡前，你需要保存当前关卡才能保留你在虚幻引擎中所做的更改。

保存关卡有以下几种方法：

- 在 **主菜单** 中点击 **文件（File）**，然后选择 **保存当前关卡（Save Current Level）**。
- 使用 **Ctrl+S**（Windows）或 **Cmd+S**（Mac）快捷键。

首次保存关卡时的界面会略有不同。你需要指定关卡的保存位置以及名称。

![Save Level As dialog window](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\save-level-as.png)

关卡另存为（Save Level As） 窗口的使用方式类似其他文件的保存对话框。为关卡资产命名，选择保存路径，然后点击 保存。

如需将关卡保存为其他名字，你可以使用以下方法：

- 在 **主菜单** 中点击 **文件（File）**，然后选择 **将当前关卡保存为（Save Current Level As）**：
- 使用 **Ctrl + Alt + S**（Windows）或 **Cmd + Option + S**（Mac）快捷键。

改变关卡时，系统会显示 **保存内容（Save Content）** 对话框，提示你保存当前关卡。

## 打开关卡

打开关卡的方法如下：

- 在 **主菜单** 中点击 **文件（File）**，然后选择 **打开关卡（Open Level）**，选择要打开的关卡。
- 使用 **Ctrl+O**（Windows）或 **Cmd+O**（Mac）快捷键。

# 管理多个关卡

在 **虚幻引擎（Unreal Engine）** 4旧版项目或非游戏项目（例如建筑可视化）上工作时，你可以使用 **关卡（Levels）** 窗口进行关卡管理。对于虚幻引擎5.0及更高版本中的游戏开发， **关卡（Levels）** 窗口被[世界分区](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/world-partition-in-unreal-engine)废弃。本页面涵盖了如何通过 **关卡（Levels）** 窗口管理多个关卡。

这些步骤使用[建筑模板](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/unreal-engine-templates-reference#建筑、工程和施工模板)作为参考。

你还可以从 **窗口（Windows）** 菜单访问 **关卡（Levels）** 窗口。

![访问关卡窗口](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\ue5-levels-window.png)

你将总是拥有一个 **持久关卡（Persistent Level）** ，并且你可以有一个或多个子关卡，子关卡总是通过 **关卡流送体积（Level Streaming Volumes）** 、 **蓝图（Blueprints）** 或 **C++代码（C++ code）** 加载或流送。 **关卡（Levels）** 窗口会显示所有这些关卡，使你能够更改哪个关卡是当前关卡（以粗体蓝色文本表示），保存一个或多个关卡，并访问关卡蓝图。如果在关卡编辑器的视口中做出了更改，你将修改当前关卡。你可以使用此窗口处理多个贴图，前提是贴图都可写。

![持久关卡](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\ue5-persistent-level.png)

右键点击 **持久关卡（Persistent Level）** 后，会显示多个操作选项，包括将该关卡设置为当前关卡、更改可视性和锁定状态、选中关卡中的所有Actor。

![持久关卡上下文菜单](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\ue5_right_clicl_persistent.png)

子关卡也有类似的选项，此外，还有一些用于移除子关卡和更改流送方法的额外选项。

![子关卡](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\ue5-sub-level.png)

更改关卡的可视性只会影响它的显示，不会对关卡能否加载进游戏产生影响。不过，当你重新生成关卡时，此处不可见的关卡将不参与构建过程；如果你的关卡很复杂，这样能大大节省时间。

## 添加新的子关卡

持久关卡或子关卡的一部分可以拆分出来，作为新的子关卡。你也可以新建关卡或添加现有关卡来创建子关卡。 添加新的子关卡后，该关卡会自动成为"当前关卡"。因此，如果你想继续使用之前的关卡，请记得右键单击之前的关卡，在菜单中 **设为当前（Make Current）** 。

### 添加已有关卡

1. 单击 **关卡（Levels）** 下拉菜单，然后选择 **添加现有（Add Existing）** ，添加一个新的子关卡。

	

2. 在 **打开关卡（Open Level）** 对话框中选择要添加的关卡，然后单击 **打开（Open）** 。

	

### 新建空白子关卡

1. 单击 **关卡（Levels）** 下拉菜单，然后选择 **新建（Create New）** ，新建一个空白子关卡。

	

2. 选择创建空白关卡或模板

	

3. 为关卡选择保存位置和名称，然后点击 **保存（Save）** 。

	

	新关卡将作为当前持久关卡的子关卡，同时也会变成当前关卡，供你在 **视口** 中操作。

### 拆分子关卡

如果你想把关卡的一部分拆分出来，以便单独加载它或与团队协作编辑），你可以选中要用的Actor，用它们新建一个关卡。

1. 在 **场景大纲视图（Scene Outliner）** 或 **视口（Viewport）** 中选中所有要移到新关卡的Actor。

2. 在 **关卡（Levels）** 窗口中，单击 **关卡（Levels）** 下拉菜单，然后选择 **使用选定Actor新建（Create New with Selected Actors）** 以创建一个新子关卡。

	

3. 为关卡选择一个保存位置和名称，然后单击 **保存（Save）** 。

	

	所有选中的Actor都会在原有关卡中被移除，并被添加到新关卡中。新关卡将作为当前持久关卡的一个子关卡，并被设置为当前关卡，供你在视口中处理。

	如果你移动的Actor被某个保留在持久关卡中的Actor所引用，引擎会弹出消息，询问你是否真的要将其从持久关卡中删除。

![删除新关卡](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\deletenewlevel.png)

## 在关卡间迁移Actor

你可以先在当前关卡中复制Actor，然后切换到目标关卡并粘贴Actor时。不过，有一种更简单的方法。

1. 在 **场景大纲视图（Scene Outliner）** 中或 **视口（Viewport）** 中选中要移至新关卡的Actor。

2. 在 **关卡（Levels）** 窗口中， **右键单击** 关卡，然后在右键菜单中选择 **移动所选Actor至关卡（Move Selected Actors to Level）** 。

	

3. 按下 **Ctrl+S** ，保存所有关卡。

## 关卡细节

在 **关卡（Levels）** 窗口中，点击图中的的放大镜标识可以打开 **关卡细节（Level Details）** 窗口，它允许你访问当前关卡的更多信息。若要设置关卡流送体积（Level Streaming Volumes），你需要打开关卡的 **关卡细节（Level Details）** ；详细操作过程，请参阅[关卡流送体积参考](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/level-streaming-using-volumes-in-unreal-engine)。

![关卡细节](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\ue5-level-details.png)

持久关卡没有额外的细节信息，除了一个用于切换到其他关卡的菜单。

![持久关卡细节](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\ue5-persistent-level-detail.png)

你可以设置子关卡的偏移 **位置（Position）** 和 **旋转（Rotation）** ，要使用的 **流送体积（Streaming Volumes）** 和调试用的 **关卡颜色（Level Color）** 。此处还有一些用于提升性能的高级设置，例如卸载请求之间的最小时间间隔。

![关卡细节面板](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\ue5-sublevel-details.png)

## 子关卡可视化选项

你可以在主 **关卡（Levels）** 窗口中或 **关卡细节（Level Details）** 窗口中设置子关卡的颜色。

若要切换关卡颜色，请点击视口上的 **显示（Show）** 按钮，然后选择 **高级（Advanced）> 关卡颜色（Level Coloration）** 。

![关卡颜色](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\ue-level-coloration.png)

持久关卡将用白色显示，而所有子关卡将用它们的选定颜色表示。 **关卡颜色（Level Coloration）** 只能在透视和正交视口下工作；在 **游戏模式（Game Mode）** 下会被关闭。

![查看关卡颜色](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\ue5-social.png)

# 世界设置

每个关卡都有从 **世界设置（World Settings）** 面板应用到关卡中的独有设置。使用此面板可以执行各种操作：从确保运行关卡时激活正确的 **游戏模式（Game Mode）** ，到调整全局光照在该关卡中的运行方式。

要打开世界设置面板，请在主菜单中转到 **窗口（Window）** ，然后选择 **世界设置（World Settings）** 。

[![img](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\world-settings-panel.png)](https://d1iv7db44yhgxn.cloudfront.net/documentation/images/a83b6813-bb3d-403f-acf2-5801a1681a9b/world-settings-panel.png)



世界设置面板的默认位置。点击查看大图。

默认情况下，**世界设置（World Settings）** 面板在编辑器UI中停靠在 **细节（Details）** 面板旁边。在这里，可以指定当前关卡的设置。

使用 **搜索（Search）** 框快速查找设置。

世界设置按照设置能够影响关卡的哪些方面来分成几组。其中的部分设置是通用的，例如能够影响游戏模式和导航的设置。其他更有针对性的设置组用于配置游戏的光照、音频、物理等。

可以调整以下设置组：

## 预先计算的可视性

预先计算的可视性体积可以减少渲染操作线程时间，但需要占用运行时内存。在处理较小的关卡或针对由于硬件（例如移动设备）限制而无法执行动态遮蔽剔除目标的平台时，此设置有助于优化游戏的性能。对于较大的、更复杂的环境，无法很好地伸缩。

如需了解更多信息，请参阅[预计算可视性体积](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/precomputed-visibility-volumes-in-unreal-engine)。

## 游戏模式

在这里可以为当前关卡选择和配置游戏模式。游戏模式定义游戏规则，例如玩家数量、得分或获胜条件。可以从你使用的项目模板随附的现有游戏模式中进行选择，或创建自定义游戏模式。

从 **GameMode重载（GameMode Override）** 下拉菜单中选择游戏模式之后，就可以配置特定于该模式的设置。

如需了解更多信息，请参阅[设置游戏模式](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/setting-up-a-game-mode-in-unreal-engine)。

## Lightmass

在此部分中，可以指定Lightmass设置，例如间接光照的细节和质量，是否使用环境光遮蔽（即模拟间接光照形成的软阴影，可以增加场景的深度）。

如需详细了解Lightmass以及可以配置的不同设置，请参阅[全局光照](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/global-illumination-in-unreal-engine)。

## 世界

这些设置会影响游戏世界的核心方面，例如关卡边界、导航系统、Actor在损坏之前可以掉落的深度。

如需了解此部分中不同领域的信息，请参阅：

- [World Composition](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/world-composition-in-unreal-engine)
- [关卡流送体积参考](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/level-streaming-volumes-reference-in-unreal-engine)

## 物理

使用此部分可以重载世界重力，而世界重力会影响某些Z轴动作，例如角色可以跳起的高度或物体的掉落速度。

此外，还可以在这里指定更多的高级设置，例如默认的物理体积类和物理碰撞处理程序类。

如需了解虚幻引擎5中物理的更多信息，请参阅[物理](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/physics-in-unreal-engine)。

## 初步检测

此部分介绍初步碰撞检测（Broadphase collision）的设置，这是NVIDIA的PhysX系统的功能。你可以指定是使用初步检测客户端还是服务器端。

虚幻引擎实施了多盒体裁剪，此功能将初步检测分割成盒体网格，而你可以控制这些盒体的设置。**MBPBounds** 和 **MBPOuter边界（MBPOuter Bounds）** 部分控制多盒体的边界。

**MBPBounds** 中的空间按照 **MBPNumSubDivs** 值进行划分，以创建网格。例如：

- 如果 MBPNumSubDivs = 2，将创建 4 单元格(2 x 2)网格。
- 如果 MBPNumSubDivs = 3，将创建 9 单元格(3 x 3)网格。

如果在物理上活跃的object掉落到 **MBPOuterBounds** 指定的边界之外，将不再为其考虑碰撞情况。启用 **使用MBPOuter边界（Use MBPOuter Bounds）** 选项将在多盒体网格边缘上创建四个专用的单元格。

如需详细了解该系统，请参阅NVIDIA关于[刚体碰撞](https://docs.nvidia.com/gameworks/content/gameworkslibrary/physx/guide/Manual/RigidBodyCollision.html)的文档。

## 分层细节级别系统

在此部分中，可以启用分层细节级别（HLOD）。

HLOD可以使用在长视野距离上具有单个组合静态网格体Actor，以取代多个静态网格体Actor。这有助于减少需要为场景渲染的Actor数量，通过减少每个帧的绘制调用数量来提高性能。

如需详细了解如何使用HLOD，请参阅[分层细节级别（HLOD）](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/hierarchical-level-of-detail-in-unreal-engine)。

## 世界分区设置和世界分区

**世界分区（World Partition）** 是新的数据管理和基于距离的关卡流送系统，可以为大型世界管理提供完整的解决方案。以前需要通过将单个持久关卡中的世界存储到网格单元格中，以便将大型关卡划分成子关卡，但现在的系统已经不需要如此操作，并且能够自动流送系统，从而根据与流送源的距离来加载和卸载这些单元格。

如需详细了解世界分区以及如何配置其设置，请参考虚幻引擎5抢先体验版文档中的[世界分区](https://docs.unrealengine.com/5.0/en-US/building-virtual-worlds/world-partition/)部分。

## 导航

配置关卡中使用的导航网格。

## 虚拟现实

使用 **米级世界缩放（World to Meters）** 变量来调整虚拟世界（VR）的大小规模。提高或降低此数字将会使用户感觉自己相对于周围的世界而言变得更大或更小了。此设置用虚幻单位（UU）来表示。在UE4中，1虚幻单位（UU）等于1厘米（cm）。

假设你的内容使用1虚幻单位 = 1厘米进行构建，将 **米级世界缩放（World to Meters）** 设置为 **10** 将会使世界看起来非常大，而将米级世界缩放设置为 **1000** 将使世界变得非常小。

如需详细了解如何缩放虚拟现实（VR）体验，请参阅[VR世界规模](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/xr-best-practices-in-unreal-engine#vrwordscale)。

如需了解在UE5中开发XR的一般性说明，请参阅[XR开发](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/developing-for-xr-experiences-in-unreal-engine)。

## 渲染

在此部分中，可以配置与距离场环境光遮蔽相关的多项配置，以及动态间接阴影。

如需了解更多信息，请参阅[距离场环境光遮蔽](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/distance-field-ambient-occlusion-in-unreal-engine)。

## 音频

使用此部分中的设置可以配置项目宏的默认音效行为，例如音量、混响和消退时间。

如需详细了解虚幻引擎5中的音频和音效，请参阅[处理音频](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/working-with-audio-in-unreal-engine)。

## 更新

**更新（Ticking）** 指的是以固定的间隔在Actor或组件上运行一段代码或蓝图脚本，通常是每帧一次。对于每个Actor或组件，更新通常单独启用。

除非游戏正在运行专门要求在一次性初始化 `BeginPlay()` 函数之前运行每帧 `Tick()` 更新函数的旧代码，否则应该禁用此选项以确保Object正确更新。

如需详细了解更新和Actor行为，请参阅[Actor更新](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/actor-ticking-in-unreal-engine)。

## 人工智能

在此部分中，可以启用虚幻引擎4的人工智能（AI）系统。

如需详细了解此系统，请参阅[人工智能](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/artificial-intelligence-in-unreal-engine)。

## 烘焙

**烘焙（Cooking）** 是构建游戏并将其部署到平台（例如PC或移动设备）的过程的一部分。这些设置影响着如何将场景中的内容包含在已构建的游戏中。

如需详细了解此过程，请参阅[游戏的打包（Packaging）和烘焙（Cooking）](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/packaging-and-cooking-games-in-unreal-engine)。



# 更改默认关卡

在[项目设置](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/project-settings-in-unreal-engine)编辑器中，你可以修改一些项目相关的设置，包括玩家打开项目后默认加载的关卡。 此外，你还可以设置编辑器打开后默认加载的关卡，比如设置成你经常使用的关卡，以此加快工作流程。

1. 点击 **编辑（Edit）** 菜单打开。

	![img](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\level_edit_options.png)

2. 选择 **项目设置（Project Settings）**。

	![img](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\level_project_settings.png)

3. 选择 **项目设置（Project Settings）** 打开项目设置。

	![img](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\level_project_settings_menu.png)

4. 点击左侧面板中的 **地图和模式（Maps & Modes）** 打开子分段。

	![img](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\level_maps_-_modes.png)

5. 点击 **游戏默认地图（Game Default Map）** 字段右方的下拉箭头，在列表中选择目标关卡。

	![img](D:\TyporaData\UnrealEngine\参考手册\01_理解基础知识\UE学习(07)：关卡.assets\level_change_default_map.png)

6. 如需变更 **编辑器默认地图（Editor Default Map）**，重复步骤 5 即可。

> 在 **默认地图（Default Maps）** 的高级部分中可设置 **本地地图选项（Local Map Options）**、**过渡地图（Transition Map）** 和 **服务器默认地图（Server Default Map）**。